FROM --platform=linux/amd64 ubuntu:24.04

RUN apt-get update && apt-get install -y -qq \
    ca-certificates \
    wget \
    xvfb \
    software-properties-common \
    && apt -qq clean \
    && apt -qq autoremove \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

RUN add-apt-repository ppa:deadsnakes/ppa && \
    apt -qq update && \
    apt -qq -y install python3.12-dev python3-pip

ENV LANG=C.UTF-8

# Project dependencies
RUN mkdir -p /opt/conda && \
    mkdir -p /miniconda && \
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O /miniconda/miniconda.sh && \
    bash /miniconda/miniconda.sh -b -u -p /opt/conda/ && \
    rm /miniconda/miniconda.sh

ENV PATH=/opt/conda/bin:$PATH
RUN conda update conda -y
COPY ./benchmark/environment.yml /home/benchmark_user/environment.yml

RUN conda env create --file /home/benchmark_user/environment.yml -y